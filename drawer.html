<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê³µê°„:ê²° - ìŠ¤ë§ˆíŠ¸ ì¸ë²¤í† ë¦¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root { --primary:#007bff; --bg:#f8fafc; --dark:#1e293b; }
body { font-family:-apple-system,sans-serif;background:var(--bg);margin:0;height:100vh;display:flex;flex-direction:column;overflow:hidden;color:var(--dark); }

.header { background:#fff;padding:15px 20px;display:flex;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,0.05); }
.header .spacer { width:40px; }
.drawer-name { font-size:18px;font-weight:800;flex:1;text-align:center; }
.icon-btn { background:none;border:none;font-size:28px;cursor:pointer;color:var(--dark);width:40px;text-align:right; }

.main-card { background:#fff;padding:15px;border-radius:0 0 25px 25px; }
.media-box { width:100%;height:250px;background:#f1f5f9;border-radius:20px;display:flex;align-items:center;justify-content:center;border:1px solid #e2e8f0;overflow:hidden; }
.media-box img { max-width:100%;max-height:100%;object-fit:contain; }
.empty-text { color:#64748b;font-size:14px;text-align:center; }

.list-header { display:flex;justify-content:space-between;align-items:center;padding:15px 15px 5px 15px; }
.add-list-btn { background:none;border:none;color:var(--primary);font-weight:bold;cursor:pointer;font-size:15px; }

.toggle-btn {
cursor:pointer;
font-size:13px;
color:#64748b;
font-weight:700;
border:1px solid #e2e8f0;
padding:6px 10px;
border-radius:8px;
background:#fff;
}

.list-container { flex:1;overflow-y:auto;padding:0 15px 15px 15px; }

.item-card { background:#fff;border-radius:18px;margin-bottom:12px;box-shadow:0 4px 12px rgba(0,0,0,0.03);border:1px solid #f1f5f9;overflow:hidden; }
.item-header { padding:15px;display:flex;justify-content:space-between;align-items:center; }
.item-name { font-weight:700;font-size:16px; }

.qty-controls { display:flex;align-items:center;gap:8px; }
.qty-btn { width:28px;height:28px;border-radius:8px;border:1px solid #e2e8f0;background:#fff;font-size:18px;display:flex;align-items:center;justify-content:center; }
.qty-num { font-weight:700;color:var(--primary);min-width:30px;text-align:center; }

.item-body { display:none;padding:0 15px 15px 15px;border-top:1px solid #f8fafc; }
.item-card.open .item-body { display:block; }

.action-btn { background:none;border:none;color:#64748b;font-size:13px;font-weight:600;cursor:pointer;padding:10px 0;margin-right:15px; }

.bottom-actions { padding:15px;background:var(--bg);display:flex;flex-direction:column;gap:10px; }
.chat-entry { background:var(--dark);color:#fff;padding:15px;border-radius:15px;display:flex;align-items:center;gap:10px;cursor:pointer; }
.reset-btn { align-self:center;background:none;border:none;color:#94a3b8;font-size:12px;text-decoration:underline;cursor:pointer;padding:5px; }
</style>
</head>

<body>

<header class="header">
<div class="spacer"></div>
<div class="drawer-name" id="drawer-title" onclick="renameDrawer()">ì„œë 1</div>
<button class="icon-btn" onclick="addItemDirectly()">ï¼‹</button>
</header>

<div class="main-card">
<div class="media-box" id="media-wrap">
<div class="empty-text">ì´ ì„œëì— ì•„ì§ ë“±ë¡ëœ ë¬¼ê±´ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>
</div>

<div class="list-header">
<button class="add-list-btn" onclick="addItemDirectly()">ï¼‹ ëª©ë¡ì¶”ê°€</button>
<div class="toggle-btn" id="toggle-all-btn" onclick="toggleAll()">ì „ì²´í¼ì¹˜ê¸°</div>
</div>

<div class="list-container">
<div id="list-items"></div>

<div class="bottom-actions">
<div class="chat-entry">
<span>ğŸ’¬</span><strong>ë¹„ì„œ 'ë´„'ì—ê²Œ ë¬¼ì–´ë³´ê¸°</strong>
</div>
<button class="reset-btn" onclick="clearAllItems()">ëª©ë¡ ì „ì²´ ì´ˆê¸°í™”</button>
</div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const tag = (params.get('tag') || 'DRAWER001').toUpperCase();

let items = JSON.parse(localStorage.getItem('gyeol_' + tag) || '[]');
let isAllOpen = false;

window.onload = () => {
document.getElementById('drawer-title').innerText =
localStorage.getItem('name_' + tag) || 'ì„œë 1';
renderItems();
};

function renderItems() {
const container = document.getElementById('list-items');

container.innerHTML = items.map((it, idx) => `
<div class="item-card ${isAllOpen ? 'open' : ''}">
<div class="item-header">
<span class="item-name">${it.n}</span>
<div class="qty-controls">
<button class="qty-btn" onclick="changeQty(${idx}, -1)">-</button>
<span class="qty-num">${it.q || 1}ê°œ</span>
<button class="qty-btn" onclick="changeQty(${idx}, 1)">+</button>
</div>
</div>
<div class="item-body">
<button class="action-btn" onclick="editItem(${idx})">ì´ë¦„ ìˆ˜ì •</button>
<button class="action-btn" style="color:#ef4444" onclick="deleteItem(${idx})">ì‚­ì œ</button>
</div>
</div>
`).join('');
}

function toggleAll() {
isAllOpen = !isAllOpen;
const btn = document.getElementById('toggle-all-btn');
btn.innerText = isAllOpen ? 'ì „ì²´ì ‘ê¸°' : 'ì „ì²´í¼ì¹˜ê¸°';
renderItems();
}

function changeQty(idx,val){
items[idx].q = Math.max(1,(items[idx].q || 1)+val);
saveData();
renderItems();
}

function deleteItem(idx){
if(confirm('ì´ ë¬¼ê±´ì„ ì‚­ì œí• ê¹Œìš”?')){
items.splice(idx,1);
saveData();
renderItems();
}
}

function editItem(idx){
const n = prompt('ìƒˆ ì´ë¦„:',items[idx].n);
if(n){
items[idx].n = n;
saveData();
renderItems();
}
}

function addItemDirectly(){
const name = prompt('ë¬¼ê±´ ì´ë¦„:');
if(name){
items.push({n:name,q:1});
saveData();
renderItems();
}
}

function clearAllItems(){
if(confirm('ì„œëì˜ ëª¨ë“  ëª©ë¡ì„ ì‚­ì œí• ê¹Œìš”?')){
items=[];
saveData();
renderItems();
}
}

function saveData(){
localStorage.setItem('gyeol_'+tag,JSON.stringify(items));
}

function renameDrawer(){
const n = prompt('ì„œë ì´ë¦„:',document.getElementById('drawer-title').innerText);
if(n){
document.getElementById('drawer-title').innerText=n;
localStorage.setItem('name_'+tag,n);
}
}
</script>

</body>
</html>
