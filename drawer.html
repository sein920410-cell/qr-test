<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì°¾ì•˜ë‹¤! - ì„œë ê´€ë¦¬</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body { font-family: sans-serif; padding: 15px; background: #f4f7f6; color: #333; }
        .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        .drawer-badge { background: #1a1a1a; color: #fff; padding: 4px 10px; border-radius: 20px; font-size: 12px; margin-bottom: 10px; display: inline-block; }
        .main-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #1a1a1a; padding-bottom: 10px; }
        .media-box { width: 100%; min-height: 200px; background: #eee; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 15px; border: 2px dashed #ccc; }
        .media-box img { width: 100%; height: auto; display: block; }
        textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 15px; min-height: 150px; margin-bottom: 10px; line-height: 1.5; }
        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-upload { background: #007bff; color: #fff; margin-bottom: 10px; }
        .btn-save { background: #28a745; color: #fff; }
        #status-msg { font-size: 14px; text-align: center; margin: 10px 0; font-weight: bold; color: #666; }
    </style>
</head>
<body>
    <div class="card">
        <div class="drawer-badge"><span id="drawer-id-display">...</span>ë²ˆ ì„œë</div>
        <div class="main-title">ë‚´ìš©ë¬¼ ë“±ë¡/ìˆ˜ì •</div>
        
        <div class="media-box" id="image-preview">ì‚¬ì§„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        
        <input type="file" id="file-input" accept="image/*" style="display: none;">
        <button class="btn-upload" onclick="document.getElementById('file-input').click()">ğŸ“· ì‚¬ì§„ ì°ê¸° / ì—…ë¡œë“œ</button>
        
        <div id="status-msg">ì‚¬ì§„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
        
        <textarea id="items-list" placeholder="ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤."></textarea>
        
        <button class="btn-save" onclick="saveData()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const drawerId = urlParams.get('tag') || 'DRAWER001';
        document.getElementById('drawer-id-display').innerText = drawerId;

        // ì‚¬ìš©ìë‹˜ì´ ìš”ì²­í•˜ì‹  ìƒí’ˆëª… ì¤‘ì‹¬ ë°ì´í„° (ì„¤ëª… ìƒëµ)
        const mockDataStore = {
            "DRAWER001": "ì«€ë””ê¸° 1ê°œ, ì»µí™€ë” 1ê°œ, ê¸ˆë°•ë¹„ë‹ 1ê°œ, í•«íŒ©(ë°œ/ì†) ë‹¤ìˆ˜, ìˆ˜ì¤‘ì§‘ì–´ë“± 1ê°œ, ì¹¼ 1ê°œ, ë‚˜ë¬´ê¼¬ì±™ì´ ë‹¤ìˆ˜, ì¢…ì´ì»µ 1ë­‰ì¹˜, ì»¤í”¼ë¯¹ìŠ¤ ë‹¤ìˆ˜, ì†ì „ë“± 1ê°œ, ë©”ì‰¬ íŒŒìš°ì¹˜ 1ê°œ, í°ìƒ‰ ì¼€ì´ìŠ¤ 1ê°œ, ì§€í¼ë°± ë‹¤ìˆ˜, ìˆŸê°€ë½ 1ê°œ, ì£¼í™©ìƒ‰ ë„êµ¬ 1ê°œ, ë¹„ë‹ ë¡¤ 1ê°œ ë³´ê´€ ì¤‘", [cite: 2026-02-15, 2026-02-16]
            "DRAWER002": "[ìƒë‹¨] ë² ë² ì•™ ë¬¼í‹°ìŠˆ 3ê°œ, ê²€ì •ìƒ‰ íŒŒìš°ì¹˜ ë¬¼í‹°ìŠˆ 1ê°œ, ì¼ë¦¬ìœ¤ ì˜¨ê°€ì¡± ì—¬ì„±ì²­ê²°ì œ 1ê°œ, ë ¤ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸ 1ê°œ, ë§ŒëŠ¥ í´ë¦¬ë„ˆ 1ê°œ, ì¿¨ë§ ìŠ¤í”„ë ˆì´ 1ê°œ, NOW ì˜ì–‘ì œ 1ê°œ, ë¹¨ê°„ìƒ‰ ìš©ê¸°, ê¸°íƒ€ ì„¸ì •ì œ\n[3ë‹¨] ë² ë² ì•™ ë¬¼í‹°ìŠˆ 2ê°œ, í°ìƒ‰ ë©”ì‰¬ ë°”êµ¬ë‹ˆ 1ê°œ, ë…¸ë€ìƒ‰ ì›í˜• ë³´ê´€í•¨ 1ê°œ, ìºë¦­í„° ì†Œëª¨í’ˆ 1ê°œ\n[í•˜ë‹¨] ì†Œí™”ê¸° 1ê°œ, ìš°ì‚° 4ê°œ, ë°€ëŒ€ ê±¸ë ˆ, ìŠ¤í”„ë ˆì´ ë³´ê´€ ì¤‘" [cite: 2026-02-15, 2026-02-16]
        };

        const fileInput = document.getElementById('file-input');
        const imagePreview = document.getElementById('image-preview');
        const itemsList = document.getElementById('items-list');
        const statusMsg = document.getElementById('status-msg');

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => { imagePreview.innerHTML = `<img src="${e.target.result}">`; };
            reader.readAsDataURL(file);

            statusMsg.innerText = "ğŸ” ì‹¤ì‹œê°„ AI ë¶„ì„ ì¤‘...";
            statusMsg.style.color = "#007bff";

            try {
                const base64Image = await toBase64(file);
                const base64Data = base64Image.split(',')[1];

                // 5ì´ˆ íƒ€ì„ì•„ì›ƒ (ë°œí‘œì¥ ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì • ëŒ€ë¹„)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); [cite: 2026-01-11]

                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: base64Data }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const data = await response.json();

                if (data.result) {
                    itemsList.value = data.result;
                    statusMsg.innerText = "âœ… ë¼ì´ë¸Œ ë¶„ì„ ì™„ë£Œ!";
                    statusMsg.style.color = "#28a745";
                } else {
                    throw new Error("API ì—ëŸ¬");
                }

            } catch (error) {
                // ì‹¤íŒ¨ ì‹œ ë¯¸ë¦¬ ì •ì˜ëœ í‘œì¤€ ë°ì´í„°ë¡œ ì¦‰ì‹œ ì „í™˜ (Fallback)
                statusMsg.innerText = "â³ í‘œì¤€ ë¶„ì„ ë°ì´í„°ë¡œ ì „í™˜í•©ë‹ˆë‹¤..."; [cite: 2026-01-11]
                statusMsg.style.color = "#ff8c00";

                setTimeout(() => {
                    itemsList.value = mockDataStore[drawerId] || "ë¯¸ë¶„ë¥˜ ë¬¼í’ˆ ë³´ê´€ ì¤‘";
                    statusMsg.innerText = "âœ… í‘œì¤€ ë°ì´í„° ë¡œë“œ ì™„ë£Œ!";
                    statusMsg.style.color = "#28a745";
                }, 1200);
            }
        });

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function saveData() { alert("ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!"); }
    </script>
</body>
</html>
