// 이미지 압축 함수 (더 강력하게 수정됨)
function resizeImage(file, maxSize) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;
                
                // 최대 크기를 800px로 조정 (용량 최적화)
                const scale = Math.min(800 / width, 800 / height, 1);
                width *= scale;
                height *= scale;
                
                canvas.width = width; canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                
                // 화질을 0.5(50%)로 낮춰 용량을 확실히 줄임
                canvas.toBlob((blob) => {
                    const resizedFile = new File([blob], file.name, {type: 'image/jpeg'});
                    console.log("압축 완료 용량:", (resizedFile.size / 1024).toFixed(2), "KB");
                    resolve(resizedFile);
                }, 'image/jpeg', 0.5); 
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    });
}
