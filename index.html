<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" /><title>시제품 관리 페이지</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f9; }
    .card { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    #edit-box { display:none; margin-top: 20px; padding: 20px; border: 1px dashed #fbc02d; border-radius: 15px; background: #fffde7; }
    input, textarea { width: 100%; margin: 10px 0; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    button { width: 100%; padding: 12px; background: #333; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <div class="card">
    <h2 id="title">로딩 중...</h2>
    <div id="items-list">불러오는 중...</div>
  </div>
  
  <div id="auth-section" style="margin-top:20px;">
    <input type="email" id="email-input" placeholder="네이버 이메일 입력">
    <button id="login-btn">인증 메일 받기</button>
    <p id="user-info" style="color: blue; font-weight: bold; margin-top: 10px;"></p>
  </div>

  <div id="edit-box">
    <p>✅ <strong>보안 인증 완료</strong></p>
    <input type="text" id="new-name" placeholder="서랍 이름 수정">
    <textarea id="new-items" rows="4" placeholder="물품 목록 수정"></textarea>
    <button id="update-btn" style="background: #2e7d32;">수정하기</button>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"
    const supabase = createClient("https://tqhtggusphhcsygiitrv.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxaHRnZ3VzcGhoY3N5Z2lpdHJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg3NjU2MjEsImV4cCI6MjA1NDM0MTYyMX0.R8xVw39vB_f1M0E6QfI0_W3M_V8_Y_Y_Y_Y_Y_Y_Y_Y")

    let tagId = new URLSearchParams(window.location.search).get("tag");

    document.getElementById("login-btn").onclick = async () => {
      const email = document.getElementById("email-input").value;
      const { error } = await supabase.auth.signInWithOtp({ email, options: { emailRedirectTo: window.location.href } });
      alert(error ? "오류 발생" : "메일을 보냈습니다! 링크를 클릭 후 돌아오세요.");
    };

    async function init() {
      const { data: { user } } = await supabase.auth.getUser();
      const { data: tag } = await supabase.from("tags").select("*").eq("id", tagId).single();

      if (tag) {
        document.getElementById("title").innerText = tag.display_name || "이름 없음";
        document.getElementById("items-list").innerText = tag.items || "물품 없음";
        
        if (user) {
          // 드디어 이 코드가 ID를 화면에 그려줍니다!
          document.getElementById("user-info").innerText = "내 ID: " + user.id;
          if (user.id === tag.owner_id) document.getElementById("edit-box").style.display = "block";
        }
      }
    }
    init();
  </script>
</body>
</html>
