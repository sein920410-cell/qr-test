<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ëª¨ë°”ì¼ ì›¹ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    .card { border: 1px solid #ddd; padding: 15px; border-radius: 10px; box-shadow: 2px 2px 5px #eee; }
    .badge { background: #e0f7fa; color: #006064; padding: 2px 8px; border-radius: 5px; font-size: 12px; }
    #edit-box { display:none; margin-top: 20px; background: #f9f9f9; padding: 15px; border-radius: 10px; }
    input, textarea { width: 100%; margin: 10px 0; padding: 10px; box-sizing: border-box; }
    button { width: 100%; padding: 10px; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="card">
    <span class="badge" id="date-label">ë‚ ì§œ ë¡œë”©ì¤‘...</span>
    <h2 id="title">ë¡œë”©ì¤‘...</h2>
    <p><strong>ğŸ“¦ í¬í•¨ëœ ë¬¼í’ˆ:</strong></p>
    <div id="items-list" style="white-space: pre-wrap;">ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  
  <div id="auth-section" style="margin-top:20px;">
    <button id="login-btn">ì‚¬ìš©ì ì¸ì¦ (êµ¬ê¸€ ë¡œê·¸ì¸)</button>
    <p id="user-info" style="color: blue; font-size: 12px;"></p>
  </div>

  <div id="edit-box">
    <p>ğŸ›¡ï¸ <strong>ë³´ì•ˆ ì¸ì¦ ì™„ë£Œ:</strong> ê´€ë¦¬ ê¶Œí•œì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
    <input type="text" id="new-name" placeholder="ì„œë ì´ë¦„ ìˆ˜ì •">
    <textarea id="new-items" rows="4" placeholder="ë¬¼í’ˆ ëª©ë¡ ìˆ˜ì • (ì˜ˆ: ë§ì¹˜, ë“œë¼ì´ë²„)"></textarea>
    <button id="update-btn">ì •ë³´ ìˆ˜ì •í•˜ê¸°</button>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

    // [ì¤‘ìš”] ì„±ê³µí–ˆë˜ ê·¸ ê¸´ í‚¤(eyJ...)ë¥¼ ë‹¤ì‹œ ì—¬ê¸°ì— ë„£ì–´ì£¼ì„¸ìš”!
    const SUPABASE_URL = "https://tqhtggusphhcsygiitrv.supabase.co"
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxaHRnZ3VzcGhoY3N5Z2lpdHJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNDMxMTMsImV4cCI6MjA4NjYxOTExM30.HXA2GbucJPkt3LFl9_JpLiwUQvI95QNEDeQWzQ9i-pc"
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

    const titleEl = document.getElementById("title");
    const dateEl = document.getElementById("date-label");
    const itemsEl = document.getElementById("items-list");
    const editBox = document.getElementById("edit-box");
    const userInfoEl = document.getElementById("user-info");

    let tagId = new URLSearchParams(window.location.search).get("tag");

    document.getElementById("login-btn").onclick = () => supabase.auth.signInWithOAuth({ provider: 'google' });

    async function updateData() {
      const { error } = await supabase.from("tags").update({ 
        display_name: document.getElementById("new-name").value,
        items: document.getElementById("new-items").value 
      }).eq("id", tagId);
      if (error) alert("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
      else { alert("ìˆ˜ì • ì™„ë£Œ!"); location.reload(); }
    }
    document.getElementById("update-btn").onclick = updateData;

    async function init() {
      const { data: { user } } = await supabase.auth.getUser();
      const { data: tag } = await supabase.from("tags").select("*").eq("id", tagId).single();

      if (tag) {
        titleEl.innerText = tag.display_name || "ì´ë¦„ ì—†ëŠ” ì„œë";
        itemsEl.innerText = tag.items || "ë¬¼í’ˆì„ ë“±ë¡í•´ ì£¼ì„¸ìš”.";
        dateEl.innerText = "ìƒì„± ë‚ ì§œ: " + new Date(tag.created_at).toLocaleDateString();
        
        if (user && user.id === tag.owner_id) {
          userInfoEl.innerText = "ê´€ë¦¬ì: " + user.email;
          editBox.style.display = "block";
          document.getElementById("new-name").value = tag.display_name;
          document.getElementById("new-items").value = tag.items || "";
        }
      }
    }
    init();
  </script>
</body>
</html>
